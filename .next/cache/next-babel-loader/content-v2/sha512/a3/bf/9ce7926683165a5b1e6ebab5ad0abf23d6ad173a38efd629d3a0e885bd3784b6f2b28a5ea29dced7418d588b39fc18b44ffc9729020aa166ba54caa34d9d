{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport { API_DOMAIN } from '@/config/globals';\nimport AuthContext from '@/context/AuthContext';\nimport OrderContext from '@/context/OrderContext';\nimport { Accordion, AccordionSummary, Typography, AccordionDetails, Grid, Divider, Table, TableHead, TableBody, TableRow, TableCell } from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport formatPrice from '@/utils/format-price';\nimport { useRouter } from 'next/router';\nimport myFetch from '../../utils/myFetch';\nimport { useSnackbar } from 'notistack';\n\nfunction orders() {\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    getToken\n  } = useContext(AuthContext);\n  const {\n    setOrder\n  } = useContext(OrderContext);\n  const {\n    0: userOrders,\n    1: setUserOrders\n  } = useState([]);\n  const router = useRouter();\n\n  const confirmOrder = async sessionId => {\n    const order = await myFetch({\n      method: 'POST',\n      path: `/orders/confirm`,\n      body: {\n        checkout_session: sessionId\n      }\n    });\n    if (order._id) enqueueSnackbar(`Listo: ${order.status.toUpperCase()}`);\n  };\n\n  useEffect(() => {\n    const path = router.asPath;\n    const i = path.search(\"=\");\n    const sessionId = path.slice(i + 1);\n\n    if (i != -1) {\n      confirmOrder(sessionId);\n      setOrder([]);\n      router.push('/user/orders');\n    }\n  }, []);\n\n  async function getUserOrders() {\n    const token = await getToken();\n    const response = await (await fetch(`${API_DOMAIN}/orders`, {\n      method: 'GET',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${token}`\n      }\n    })).json();\n    setUserOrders(response);\n  }\n\n  useEffect(() => {\n    getUserOrders();\n  }, []);\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      spacing: 5,\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h4\",\n          align: \"center\",\n          children: \"MIS COMPRAS\"\n        })\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: userOrders.map(o => /*#__PURE__*/_jsxs(Accordion, {\n          children: [/*#__PURE__*/_jsx(AccordionSummary, {\n            expandIcon: /*#__PURE__*/_jsx(ExpandMoreIcon, {}),\n            children: /*#__PURE__*/_jsxs(Grid, {\n              container: true,\n              spacing: 2,\n              children: [/*#__PURE__*/_jsxs(Grid, {\n                item: true,\n                xs: 8,\n                children: [/*#__PURE__*/_jsx(Typography, {\n                  gutterBottom: true,\n                  variant: \"overline\",\n                  children: new Date(o.createdAt).toLocaleString()\n                }), /*#__PURE__*/_jsx(Typography, {\n                  gutterBottom: true,\n                  variant: \"subtitle1\",\n                  children: o.status\n                }), /*#__PURE__*/_jsx(Typography, {\n                  variant: \"subtitle1\",\n                  children: formatPrice('MXN', o.total)\n                })]\n              }), /*#__PURE__*/_jsx(Grid, {\n                item: true,\n                xs: 1,\n                children: /*#__PURE__*/_jsx(Divider, {\n                  orientation: \"vertical\"\n                })\n              }), /*#__PURE__*/_jsx(Grid, {\n                item: true,\n                xs: 3,\n                style: {\n                  display: \"flex\",\n                  alignItems: \"center\"\n                },\n                children: /*#__PURE__*/_jsx(Typography, {\n                  variant: \"h6\",\n                  children: o.delivery_status.toUpperCase()\n                })\n              })]\n            })\n          }), /*#__PURE__*/_jsx(AccordionDetails, {\n            children: /*#__PURE__*/_jsxs(Table, {\n              size: \"small\",\n              children: [/*#__PURE__*/_jsx(TableHead, {\n                children: /*#__PURE__*/_jsxs(TableRow, {\n                  children: [/*#__PURE__*/_jsx(TableCell, {\n                    align: \"center\",\n                    children: \"ARTICULO\"\n                  }), /*#__PURE__*/_jsx(TableCell, {\n                    align: \"center\",\n                    children: \"COLOR\"\n                  }), /*#__PURE__*/_jsx(TableCell, {\n                    align: \"center\",\n                    children: \"TAMA\\xD1O\"\n                  })]\n                })\n              }), /*#__PURE__*/_jsx(TableBody, {\n                children: o.variants.map(v => /*#__PURE__*/_jsxs(TableRow, {\n                  children: [/*#__PURE__*/_jsx(TableCell, {\n                    children: v.name\n                  }), /*#__PURE__*/_jsx(TableCell, {\n                    align: \"center\",\n                    children: v.color\n                  }), /*#__PURE__*/_jsx(TableCell, {\n                    align: \"center\",\n                    children: v.size\n                  })]\n                }, `Variant-${v.id}`))\n              })]\n            })\n          })]\n        }, `Order-${o.id}`))\n      })]\n    })\n  });\n}\n\nexport default orders;","map":null,"metadata":{},"sourceType":"module"}