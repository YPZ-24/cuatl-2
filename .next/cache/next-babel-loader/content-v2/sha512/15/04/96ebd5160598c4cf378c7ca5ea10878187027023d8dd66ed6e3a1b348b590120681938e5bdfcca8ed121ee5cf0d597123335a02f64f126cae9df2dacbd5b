{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"C:/Users/DELL/Desktop/A/cuatl-2/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/DELL/Desktop/A/cuatl-2/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport { API_DOMAIN } from '@/config/globals';\nimport AuthContext from '@/context/AuthContext';\nimport OrderContext from '@/context/OrderContext';\nimport { Accordion, AccordionSummary, Typography, AccordionDetails, Grid, Divider, Table, TableHead, TableBody, TableRow, TableCell } from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport formatPrice from '@/utils/format-price';\nimport { useRouter } from 'next/router';\nimport myFetch from '../../utils/myFetch';\nimport { useSnackbar } from 'notistack';\n\nfunction orders() {\n  var _useSnackbar = useSnackbar(),\n      enqueueSnackbar = _useSnackbar.enqueueSnackbar;\n\n  var _useContext = useContext(AuthContext),\n      getToken = _useContext.getToken;\n\n  var _useContext2 = useContext(OrderContext),\n      setOrder = _useContext2.setOrder;\n\n  var _useState = useState([]),\n      userOrders = _useState[0],\n      setUserOrders = _useState[1];\n\n  var router = useRouter();\n\n  var confirmOrder = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(sessionId) {\n      var order;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return myFetch({\n                method: 'POST',\n                path: \"/orders/confirm\",\n                body: {\n                  checkout_session: sessionId\n                }\n              });\n\n            case 2:\n              order = _context.sent;\n              if (order._id) enqueueSnackbar(\"Listo: \".concat(order.status.toUpperCase()));\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function confirmOrder(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var path = router.asPath;\n    var i = path.search(\"=\");\n    var sessionId = path.slice(i + 1);\n\n    if (i != -1) {\n      confirmOrder(sessionId);\n      setOrder([]);\n      router.push('/user/orders');\n    }\n  }, []);\n\n  function getUserOrders() {\n    return _getUserOrders.apply(this, arguments);\n  }\n\n  function _getUserOrders() {\n    _getUserOrders = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var token, response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return getToken();\n\n            case 2:\n              token = _context2.sent;\n              _context2.next = 5;\n              return fetch(\"\".concat(API_DOMAIN, \"/orders\"), {\n                method: 'GET',\n                headers: {\n                  'Content-Type': 'application/json',\n                  'Authorization': \"Bearer \".concat(token)\n                }\n              });\n\n            case 5:\n              _context2.next = 7;\n              return _context2.sent.json();\n\n            case 7:\n              response = _context2.sent;\n              setUserOrders(response);\n\n            case 9:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _getUserOrders.apply(this, arguments);\n  }\n\n  useEffect(function () {\n    getUserOrders();\n  }, []);\n  return /*#__PURE__*/_jsx(_Fragment, {\n    children: /*#__PURE__*/_jsxs(Grid, {\n      container: true,\n      spacing: 5,\n      children: [/*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: /*#__PURE__*/_jsx(Typography, {\n          variant: \"h4\",\n          align: \"center\",\n          children: \"MIS COMPRAS\"\n        })\n      }), /*#__PURE__*/_jsx(Grid, {\n        item: true,\n        xs: 12,\n        children: userOrders.map(function (o) {\n          return /*#__PURE__*/_jsxs(Accordion, {\n            children: [/*#__PURE__*/_jsx(AccordionSummary, {\n              expandIcon: /*#__PURE__*/_jsx(ExpandMoreIcon, {}),\n              children: /*#__PURE__*/_jsxs(Grid, {\n                container: true,\n                spacing: 2,\n                children: [/*#__PURE__*/_jsxs(Grid, {\n                  item: true,\n                  xs: 8,\n                  children: [/*#__PURE__*/_jsx(Typography, {\n                    gutterBottom: true,\n                    variant: \"overline\",\n                    children: new Date(o.createdAt).toLocaleString()\n                  }), /*#__PURE__*/_jsx(Typography, {\n                    gutterBottom: true,\n                    variant: \"subtitle1\",\n                    children: o.status\n                  }), /*#__PURE__*/_jsx(Typography, {\n                    variant: \"subtitle1\",\n                    children: formatPrice('MXN', o.total)\n                  })]\n                }), /*#__PURE__*/_jsx(Grid, {\n                  item: true,\n                  xs: 1,\n                  children: /*#__PURE__*/_jsx(Divider, {\n                    orientation: \"vertical\"\n                  })\n                }), /*#__PURE__*/_jsx(Grid, {\n                  item: true,\n                  xs: 3,\n                  style: {\n                    display: \"flex\",\n                    alignItems: \"center\"\n                  },\n                  children: /*#__PURE__*/_jsx(Typography, {\n                    variant: \"h6\",\n                    children: o.delivery_status.toUpperCase()\n                  })\n                })]\n              })\n            }), /*#__PURE__*/_jsx(AccordionDetails, {\n              children: /*#__PURE__*/_jsxs(Table, {\n                size: \"small\",\n                children: [/*#__PURE__*/_jsx(TableHead, {\n                  children: /*#__PURE__*/_jsxs(TableRow, {\n                    children: [/*#__PURE__*/_jsx(TableCell, {\n                      align: \"center\",\n                      children: \"ARTICULO\"\n                    }), /*#__PURE__*/_jsx(TableCell, {\n                      align: \"center\",\n                      children: \"COLOR\"\n                    }), /*#__PURE__*/_jsx(TableCell, {\n                      align: \"center\",\n                      children: \"TAMA\\xD1O\"\n                    })]\n                  })\n                }), /*#__PURE__*/_jsx(TableBody, {\n                  children: o.variants.map(function (v) {\n                    return /*#__PURE__*/_jsxs(TableRow, {\n                      children: [/*#__PURE__*/_jsx(TableCell, {\n                        children: v.name\n                      }), /*#__PURE__*/_jsx(TableCell, {\n                        align: \"center\",\n                        children: v.color\n                      }), /*#__PURE__*/_jsx(TableCell, {\n                        align: \"center\",\n                        children: v.size\n                      })]\n                    }, \"Variant-\".concat(v.id));\n                  })\n                })]\n              })\n            })]\n          }, \"Order-\".concat(o.id));\n        })\n      })]\n    })\n  });\n}\n\nexport default orders;","map":null,"metadata":{},"sourceType":"module"}